!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["react","react-dom"],t):(e=e||self)["react-handwriting-keyboard"]=t(e.React,e.ReactDOM)}(this,(function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;t.length>n;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=r(e);if(t){var o=r(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return s(this,n)}}e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t;var l=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){
/*!
    Copyright (c) 2017 Jed Watson.
    Licensed under the MIT License (MIT), see
    http://jedwatson.github.io/classnames
  */
!function(){var t={}.hasOwnProperty;function n(){for(var e=[],i=0;arguments.length>i;i++){var o=arguments[i];if(o){var r=typeof o;if("string"===r||"number"===r)e.push(o);else if(Array.isArray(o)&&o.length){var a=n.apply(null,o);a&&e.push(a)}else if("object"===r)for(var s in o)t.call(o,s)&&o[s]&&e.push(s)}}return e.join(" ")}e.exports?(n.default=n,e.exports=n):window.classNames=n}()})),d=function(){function e(t,i){n(this,e),this.canvas=t,this.cxt=t.getContext("2d"),this.cxt.lineCap="round",this.cxt.lineJoin="round",this.lineWidth=i||3,this.width=t.width,this.height=t.height,this.drawing=!1,this.handwritingX=[],this.handwritingY=[],this.trace=[],this.options={},this.step=[],this.redo_step=[],this.redo_trace=[],this.allowUndo=!1,this.allowRedo=!1,this.timer=null,this.callback=null,this.canvas.addEventListener("mousedown",this.mouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.mouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.mouseUp.bind(this)),this.canvas.addEventListener("touchstart",this.touchStart.bind(this)),this.canvas.addEventListener("touchmove",this.touchMove.bind(this)),this.canvas.addEventListener("touchend",this.touchEnd.bind(this))}return o(e,[{key:"set_Undo_Redo",value:function(e,t){this.allowUndo=e,this.allowRedo=!!e&&t,this.allowUndo||(this.step=[],this.redo_step=[],this.redo_trace=[])}},{key:"setLineWidth",value:function(e){this.lineWidth=e}},{key:"setCallBack",value:function(e){this.callback=e}},{key:"setOptions",value:function(e){this.options=e}},{key:"mouseDown",value:function(e){this.cxt.lineWidth=this.lineWidth,this.handwritingX=[],this.handwritingY=[],this.drawing=!0,this.cxt.beginPath();var t=this.canvas.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top;this.cxt.moveTo(n,i),this.handwritingX.push(n),this.handwritingY.push(i),this.timer&&clearTimeout(this.timer)}},{key:"mouseMove",value:function(e){if(this.drawing){var t=this.canvas.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top;this.cxt.lineTo(n,i),this.cxt.stroke(),this.handwritingX.push(n),this.handwritingY.push(i)}}},{key:"mouseUp",value:function(){var e=this,t=[];t.push(this.handwritingX),t.push(this.handwritingY),t.push([]),this.trace.push(t),this.drawing=!1,this.allowUndo&&this.step.push(this.toDataURL()),this.timer=setTimeout((function(){e.recognize()}),500)}},{key:"touchStart",value:function(e){e.preventDefault(),this.cxt.lineWidth=this.lineWidth,this.handwritingX=[],this.handwritingY=[];var t=document.documentElement,n=this.getBoundingClientRect(),i=n.top+window.pageYOffset-t.clientTop,o=n.left+window.pageXOffset-t.clientLeft,r=e.changedTouches[0],a=r.pageX-o,s=r.pageY-i;this.handwritingX.push(a),this.handwritingY.push(s),this.cxt.beginPath(),this.cxt.moveTo(a,s),this.timer&&clearTimeout(this.timer)}},{key:"touchMove",value:function(e){e.preventDefault();var t=e.targetTouches[0],n=document.documentElement,i=this.getBoundingClientRect(),o=i.top+window.pageYOffset-n.clientTop,r=i.left+window.pageXOffset-n.clientLeft,a=t.pageX-r,s=t.pageY-o;this.handwritingX.push(a),this.handwritingY.push(s),this.cxt.lineTo(a,s),this.cxt.stroke()}},{key:"touchEnd",value:function(e){var t=this,n=[];n.push(this.handwritingX),n.push(this.handwritingY),n.push([]),this.trace.push(n),this.allowUndo&&this.step.push(this.toDataURL()),this.timer=setTimeout((function(){t.recognize()}),500)}},{key:"undo",value:function(){this.allowUndo&&this.step.length>0&&(1===this.step.length?this.allowRedo&&(this.redo_step.push(this.step.pop()),this.redo_trace.push(this.trace.pop()),this.cxt.clearRect(0,0,this.width,this.height)):(this.allowRedo?(this.redo_step.push(this.step.pop()),this.redo_trace.push(this.trace.pop())):(this.step.pop(),this.trace.pop()),this.loadFromUrl(this.step.slice(-1)[0])))}},{key:"redo",value:function(){this.allowRedo&&this.redo_step.length>0&&(this.step.push(this.redo_step.pop()),this.trace.push(this.redo_trace.pop()),this.loadFromUrl(this.step.slice(-1)[0]))}},{key:"erase",value:function(){this.cxt.clearRect(0,0,this.width,this.height),this.step=[],this.redo_step=[],this.redo_trace=[],this.trace=[]}},{key:"loadFromUrl",value:function(e){var t=new Image;t.onload=function(){this.canvas.cxt.clearRect(0,0,this.width,this.height),this.canvas.cxt.drawImage(t,0,0)},t.src=e}},{key:"recognize",value:function(){var e=JSON.stringify({options:"enable_pre_space",requests:[{writing_guide:{writing_area_width:this.options.width||this.width||void 0,writing_area_height:this.options.height||this.width||void 0},ink:this.trace,language:this.options.language||"pt_BR"}]}),t=this,n=new XMLHttpRequest;n.addEventListener("readystatechange",(function(){if(4===this.readyState)switch(this.status){case 200:var e,n=JSON.parse(this.responseText);1===n.length?console.log(Error(n[0])):(t.erase(),e=n[1][0][1]),t.options.numOfWords&&(e=e.filter((function(e){return e.length===t.options.numOfWords}))),t.options&&t.options.numOfReturn&&(e=e.slice(0,this.options.numOfReturn)),t.callback(e,void 0);break;case 403:t.callback(void 0,Error("access denied"));break;case 503:t.callback(void 0,Error("can't connect to recognition server"))}})),n.open("POST","https://www.google.cn/inputtools/request?ime=handwriting&app=mobilesearch&cs=1&oe=UTF-8"),n.setRequestHeader("content-type","application/json"),n.send(e)}}]),e}();!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}('@import "//at.alicdn.com/t/font_2025382_zp7gawrqpdc.css";.keyboard{z-index:100;position:fixed;right:0;bottom:0;left:0;opacity:0;transition:.2s ease-in;background-color:#eceff1;transform:translate3d(0,100%,0);box-shadow:0 0 0 transparent,0 -2px 20px #cecece}.keyboard.show{transform:translateZ(0);opacity:1}.keyboard .keyboard-output{position:relative;width:100%;padding:8px 12px;background-color:#fbfcfc}.keyboard .keyboard-output input{height:100%;width:100%;padding:10px;font-size:20px;color:#8e729d;background:#eceff1;border:1px solid #e0e3e5;border-radius:4px;outline:none}.keyboard .keyboard-output .icon-Emptied{position:absolute;top:50%;right:24px;font-size:20px;color:rgba(0,0,0,.4);transform:translateY(-50%);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.keyboard .keyboard-output .icon-Emptied:hover{color:rgba(255,0,0,.6)}.keyboard .keyboard-nav{height:50px;text-align:center;background-color:#fbfcfc}.keyboard .keyboard-nav .nav-item{display:inline-block;width:200px;height:44px;margin-top:6px;line-height:44px;font-size:18px;color:#37474f;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.keyboard .keyboard-nav .nav-item.active{background-color:#eceff1;border-radius:2px 2px 0 0}.keyboard .keyboard-content{padding:14px 13px 10px}.keyboard .keyboard-content .content-item{display:none;margin:0;padding:0}.keyboard .keyboard-content .content-item.active{display:flex;align-items:stretch}.keyboard .keyboard-content .content-item.handwriting .handwriting-enter{flex-grow:1;display:flex;flex-direction:column}.keyboard .keyboard-content .content-item.handwriting .handwriting-enter .handwriting-options{height:65px;margin:0 0 13px;padding:0 12px;line-height:65px;background-color:#fff;font-size:24px;color:#37474f;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.keyboard .keyboard-content .content-item.handwriting .handwriting-enter .handwriting-options .options-word{display:inline-block;margin-right:30px}.keyboard .keyboard-content .content-item.handwriting .handwriting-enter .handwriting-options .options-holder{font-size:18px;opacity:.3}.keyboard .keyboard-content .content-item.handwriting .handwriting-enter .handwriting-drawboard{height:226px;width:100%;background-color:#fff}.keyboard .keyboard-content .content-item.handwriting .handwriting-action{display:flex;list-style:none;flex-direction:column;flex-basis:170px;margin:0 0 0 13px}.keyboard .keyboard-content .content-item.handwriting .handwriting-action .action-item{height:65px;width:100%;margin-bottom:13px;background:#e0e3e5;border-radius:2px;line-height:65px;font-size:18px;color:#37474f;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.keyboard .keyboard-content .content-item.handwriting .handwriting-action .action-item:last-child{height:70px;margin-bottom:0;margin-top:auto;line-height:70px;color:#fff;background-color:#f47215;border:1px solid #f47215;border-radius:2px}.keyboard .keyboard-content .content-item.handwriting .handwriting-action .action-item:last-child:active{background-image:linear-gradient(-180deg,#4b3185,#4b3185)}.keyboard .keyboard-content .content-item.handwriting .handwriting-action .action-item:active{background-color:#fbfcfc}.keyboard .keyboard-content .content-item.handwriting .handwriting-action .action-item .iconfont{font-size:32px;color:#7b868b}.keyboard .keyboard-content .content-item.letter{flex-direction:column}.keyboard .keyboard-content .content-item.letter .letter-line{display:flex;justify-content:flex-end;width:100%;margin-bottom:13px}.keyboard .keyboard-content .content-item.letter .letter-line .letter-cell{flex:1 1 110px;height:65px;margin-right:13px;line-height:65px;font-size:30px;color:#37474f;text-align:center;background-color:#fbfcfc;border-radius:2px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.keyboard .keyboard-content .content-item.letter .letter-line .letter-cell:last-child{margin-right:0}.keyboard .keyboard-content .content-item.letter .letter-line .letter-cell.dusky{background-color:#e0e3e5}.keyboard .keyboard-content .content-item.letter .letter-line .letter-cell.dusky:active{background-color:#fbfcfc}.keyboard .keyboard-content .content-item.letter .letter-line .letter-cell.dusky .iconfont{color:#7b868b}.keyboard .keyboard-content .content-item.letter .letter-line .letter-cell.space{flex:6 1 725px}.keyboard .keyboard-content .content-item.letter .letter-line .letter-cell.space .iconfont{font-size:48px;color:#7b868b}.keyboard .keyboard-content .content-item.letter .letter-line .letter-cell.confirm{color:#fff;font-size:20px;background-color:#f47215;border:1px solid #f47215;border-radius:2px}.keyboard .keyboard-content .content-item.letter .letter-line .letter-cell.confirm:active{background-image:linear-gradient(-180deg,#4b3185,#4b3185)}.keyboard .keyboard-content .content-item.letter .letter-line .letter-cell:active{background-color:#e0e3e5}.keyboard .keyboard-content .content-item.letter .letter-line .letter-cell .iconfont{font-size:32px;color:#6b529e}.keyboard .keyboard-content .content-item.letter .letter-line .letter-cell .iconfont.icon-uppercaseletter{font-size:28px}.keyboard .keyboard-content .content-item.letter .letter-line:nth-child(2):before{content:"";flex-basis:55px;margin-right:13px}.keyboard .keyboard-content .content-item.letter .letter-line:nth-child(2) .letter-cell:last-child{flex-basis:170px}.keyboard .keyboard-content .content-item.digital{flex-direction:column}.keyboard .keyboard-content .content-item.digital .digital-line{display:flex;justify-content:flex-end;width:100%;margin-bottom:13px}.keyboard .keyboard-content .content-item.digital .digital-line .digital-cell{flex-basis:316px;flex-grow:1;height:65px;margin-right:13px;line-height:65px;font-size:30px;color:#37474f;text-align:center;background-color:#fbfcfc;border-radius:2px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.keyboard .keyboard-content .content-item.digital .digital-line .digital-cell:first-child{flex-basis:170px}.keyboard .keyboard-content .content-item.digital .digital-line .digital-cell:last-child{flex-basis:170px;margin-right:0}.keyboard .keyboard-content .content-item.digital .digital-line .digital-cell.dusky{background-color:#e0e3e5}.keyboard .keyboard-content .content-item.digital .digital-line .digital-cell.dusky:active{background-color:#fbfcfc}.keyboard .keyboard-content .content-item.digital .digital-line .digital-cell.dusky .iconfont{font-size:32px;color:#7b868b}.keyboard .keyboard-content .content-item.digital .digital-line .digital-cell.dusky .iconfont.icon-space{font-size:48px;transform:scale(.5)}.keyboard .keyboard-content .content-item.digital .digital-line .digital-cell.confirm{color:#fff;font-size:20px;background-color:#f47215;border:1px solid #f47215;border-radius:2px}.keyboard .keyboard-content .content-item.digital .digital-line .digital-cell.confirm:active{background-image:linear-gradient(-180deg,#4b3185,#4b3185)}.keyboard .keyboard-content .content-item.digital .digital-line .digital-cell:active{background-color:#e0e3e5}');var h=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(r,t);var i=c(r);function r(){var e;n(this,r);for(var t=arguments.length,o=Array(t),a=0;t>a;a++)o[a]=arguments[a];return(e=i.call.apply(i,[this].concat(o))).state={visible:!1,cursorPos:e.props.target.value?e.props.target.value.length:0,value:e.props.target.value||"",keyboardType:0,characters:[],letters:[["q","w","e","r","t","y","u","i","o","p","icon-keyboard dusky"],["a","s","d","f","g","h","j","k","l","icon-delete dusky"],["icon-uppercase dusky","z","x","c","v","b","n","m","! dusky","? dusky","# dusky"],["~ dusky","/ dusky","icon-space space",". dusky",", dusky","确定 confirm"]],upperCase:!1},e.handleSwitchKeyBoard=function(t){e.setState({keyboardType:t,characters:[]})},e.handleSelectCharacters=function(t){var n=e.state.value,i=e.input.selectionEnd,o=0===i-e.input.selectionStart?i-1:e.input.selectionStart,r=n.substr(0,o)+t.target.innerText+n.substr(i,n.length-1);e.setState({value:r,cursorPos:o+t.target.innerText.length,characters:[]})},e.handlePressKey=function(t,n){var i=e.props,o=i.onChange,r=i.onClose,a=e.state,s=a.value,c=a.letters,l=a.upperCase,d=e.input.selectionEnd;if(t.length>1&&t.indexOf("icon")>-1)switch(t.match(/-(\w+)/)[1]){case"keyboard":n.stopPropagation(),r&&r();break;case"delete":var h=d-e.input.selectionStart,u=0===h?d-1:d-h;if(d>0){var p=s.substr(0,0===h?d-1:e.input.selectionStart)+s.substr(d,s.length-1);e.setState({value:p,cursorPos:u,characters:[]})}break;case"uppercase":var g=c.map((function(e){return e=e.map((function(e){if(1===e.length)e=e[l?"toLowerCase":"toUpperCase"]();else if(e.indexOf("uppercase")>-1){var t=l?" dusky":"";e=e.split(" ")[0]+t}return e}))}));e.setState({letters:g,upperCase:!l});break;case"space":e.setState({value:s.substr(0,d)+" "+s.substr(d,s.length-1),cursorPos:d+1})}else t.indexOf("确定")>-1?(n.stopPropagation(),o&&o(s),r&&r()):t.indexOf("重写")>-1?console.log("重写"):e.setState({value:s.substr(0,d)+t+s.substr(d,s.length-1),cursorPos:d+1})},e.handleChange=function(t){e.setState({value:t.target.value,cursorPos:e.input.selectionEnd})},e.handleKeyboardClick=function(){e.input.focus()},e.clearValue=function(){e.setState({value:"",characters:[]})},e}return o(r,[{key:"componentDidMount",value:function(){var e=this,t=this.state.value.length;this.input.focus(),this.input.setSelectionRange(t,t);var n=this.drawboard.getBoundingClientRect();this.drawboard.height=n.height,this.drawboard.width=n.width;var i=new d(this.drawboard),o=this;i.setCallBack((function(e,t){if(t)throw t;if(e&&e.length>0){var n=o.state.value,i=o.input.selectionEnd;o.setState({value:n.substr(0,i)+e[0]+n.substr(i,n.length-1),cursorPos:i+e[0].length,characters:e}),o.input.setSelectionRange(i,i+e[0].length)}})),this.setState({visible:!0}),setTimeout((function(){document.getElementById("root").addEventListener("click",e.props.onClose,!1)}),500)}},{key:"componentDidUpdate",value:function(){var e=this.state.cursorPos;this.input.setSelectionRange(e,e)}},{key:"componentWillUnmount",value:function(){document.getElementById("root").removeEventListener("click",this.props.onClose,!1)}},{key:"render",value:function(){var t=this,n=this.state,i=n.value,o=n.autoFocus,r=n.keyboardType,a=n.characters,s=n.letters;return e.createElement("div",{className:l({keyboard:!0,show:n.visible}),onClick:this.handleKeyboardClick},e.createElement("header",{className:"keyboard-output"},e.createElement("input",{type:"text",value:i,autoFocus:o,ref:function(e){return t.input=e},onChange:this.handleChange}),e.createElement("i",{className:"iconfont icon-Emptied",onClick:this.clearValue})),e.createElement("ul",{className:"keyboard-nav"},['Quadro', 'Teclado comum', 'Teclado numérico'].map((function(n,i){return e.createElement("li",{key:n,className:l({"nav-item":!0,active:r===i}),onClick:t.handleSwitchKeyBoard.bind(t,i)},n)}))),e.createElement("section",{className:"keyboard-content"},e.createElement("div",{className:l({"content-item":!0,handwriting:!0,active:0===r})},e.createElement("div",{className:"handwriting-enter"},e.createElement("p",{className:"handwriting-options"},0===a.length?e.createElement("span",{className:"options-holder"},"Comece a escrever"):a.map((function(n){return e.createElement("span",{key:n,className:"options-word",onClick:t.handleSelectCharacters},n)}))),e.createElement("canvas",{className:"handwriting-drawboard",ref:function(e){return t.drawboard=e}})),e.createElement("ul",{className:"handwriting-action"},["icon-keyboard","icon-delete","Confirmar"].map((function(n){var i=n.indexOf("icon")>-1&&n;return e.createElement("li",{key:n,className:"action-item",onClick:t.handlePressKey.bind(t,n)},i?e.createElement("i",{className:"iconfont "+i}):n)})))),e.createElement("ul",{className:l({"content-item":!0,letter:!0,active:1===r})},s.map((function(n,i){return e.createElement("li",{key:i,className:"letter-line"},n.map((function(n,i){var o=n.split(" ")[0],r=o.indexOf("icon")>-1&&o,a=n.split(" ")[1];return e.createElement("span",{key:o,className:"letter-cell".concat(a?" "+a:""),onClick:t.handlePressKey.bind(t,o)},r?e.createElement("i",{className:"iconfont "+r}):o)})))}))),e.createElement("ul",{className:l({"content-item":!0,digital:!0,active:2===r})},[["- dusky","1","2","3","icon-keyboard dusky"],["+ dusky","4","5","6","icon-delete dusky"],["/ dusky","7","8","9","icon-space dusky"],["~ dusky","。 dusky","0",", dusky","确定 confirm"]].map((function(n,i){return e.createElement("li",{key:i,className:"digital-line"},n.map((function(n,i){var o=n.split(" ")[0],r=o.indexOf("icon")>-1&&o,a=n.split(" ")[1];return e.createElement("span",{key:o,className:"digital-cell".concat(a?" "+a:""),onClick:t.handlePressKey.bind(t,o)},r?e.createElement("i",{className:"iconfont "+r}):o)})))})))))}}]),r}(e.Component);return new(function(){function i(){n(this,i),this.keyboardLayer=document.createElement("div"),this.keyboardLayer.setAttribute("class","keyboard-layer"),document.body.appendChild(this.keyboardLayer)}return o(i,[{key:"show",value:function(n){var i=n.target,o=n.onChange;this.target=i,t.render(e.createElement(h,{target:i,onChange:o,onClose:this.close.bind(this)}),this.keyboardLayer)}},{key:"close",value:function(e){var n=this;e&&e.target===this.target||0>=this.keyboardLayer.getElementsByClassName("keyboard").length||(this.keyboardLayer.getElementsByClassName("keyboard")[0].setAttribute("class","keyboard"),setTimeout((function(){t.unmountComponentAtNode(n.keyboardLayer)}),250))}}]),i}())}));
